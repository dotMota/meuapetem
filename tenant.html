<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Página do Corretor | MeuApêTem Platform</title>
  <link rel="icon" type="image/png" href="./media/utils/mAPTmLogo.svg">
  <style>
    :root {
      --primary: #d4af37;
      --surface: #101010;
      --card: #1a1a1a;
      --text: #f5f5f7;
      --textSoft: #b4b4be;
    }

    body {
      margin: 0;
      font-family: "Manrope", Arial, sans-serif;
      background: var(--surface);
      color: var(--text);
      line-height: 1.6;
    }

    .container {
      max-width: 1020px;
      margin: 0 auto;
      padding: 24px 18px 64px;
    }

    .hero {
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 18px;
      padding: 28px;
      background: linear-gradient(140deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      margin-bottom: 18px;
    }

    .hero h1 { margin: 0 0 8px; font-size: clamp(2rem, 4vw, 3rem); }

    .hero p { margin: 0 0 14px; color: var(--textSoft); }

    .btn {
      display: inline-block;
      padding: 10px 14px;
      border-radius: 10px;
      text-decoration: none;
      font-weight: 700;
      background: var(--primary);
      color: #121212;
    }

    .card {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 18px;
      margin-bottom: 14px;
    }

    .grid {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .tag {
      display: inline-block;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 999px;
      padding: 2px 8px;
      font-size: .8rem;
      color: var(--textSoft);
      margin-bottom: 8px;
    }

    .muted { color: var(--textSoft); }
  </style>
  <script src="./services/platform.service.js" defer></script>
</head>

<body>
  <main class="container" id="app"></main>

  <script>
    function getSlug() {
      const params = new URLSearchParams(window.location.search);
      return params.get('slug') || 'studio';
    }

    function applyPalette(palette) {
      document.documentElement.style.setProperty('--primary', palette.primary);
      document.documentElement.style.setProperty('--surface', palette.surface);
      document.documentElement.style.setProperty('--card', palette.card);
      document.documentElement.style.setProperty('--text', palette.text);
      document.documentElement.style.setProperty('--textSoft', palette.textSoft);
    }

    function renderBrokerPage(broker) {
      const { site, brand } = broker;
      const enabled = new Set(site.enabledBlocks || []);
      const app = document.getElementById('app');

      const html = [];

      if (enabled.has('hero')) {
        html.push(`
          <section class="hero">
            <small class="muted">${broker.name}</small>
            <h1>${site.homepage.title}</h1>
            <p>${site.homepage.subtitle}</p>
            <a class="btn" href="${site.homepage.ctaUrl}" target="_blank" rel="noopener">${site.homepage.ctaText}</a>
          </section>
        `);
      }

      if (enabled.has('highlights')) {
        html.push(`
          <section class="card">
            <h2>Diferenciais</h2>
            <div class="grid">
              ${site.homepage.highlights.map((item) => `<article class="card"><strong>${item}</strong></article>`).join('')}
            </div>
          </section>
        `);
      }

      if (enabled.has('projects')) {
        html.push(`
          <section class="card">
            <h2>Oportunidades em destaque</h2>
            <div class="grid">
              ${site.catalog.map((project) => `
                <article class="card">
                  <span class="tag">${project.tag}</span>
                  <h3>${project.title}</h3>
                  <p class="muted">${project.description}</p>
                </article>
              `).join('')}
            </div>
          </section>
        `);
      }

      if (enabled.has('testimonial')) {
        html.push(`
          <section class="card">
            <h2>Prova social</h2>
            <blockquote>“${site.homepage.testimonial.quote}”</blockquote>
            <p class="muted">${site.homepage.testimonial.author}</p>
          </section>
        `);
      }

      if (enabled.has('contact')) {
        html.push(`
          <section class="card">
            <h2>Contato</h2>
            <p>${brand.phone}</p>
            <p>${brand.instagram}</p>
            <a class="btn" href="${brand.whatsapp}" target="_blank" rel="noopener">Conversar no WhatsApp</a>
          </section>
        `);
      }

      app.innerHTML = html.join('');
    }

    window.addEventListener('DOMContentLoaded', () => {
      const slug = getSlug();
      const broker = window.PlatformService.findBrokerBySlug(slug);
      const app = document.getElementById('app');

      if (!broker) {
        app.innerHTML = '<section class="card"><h1>Corretor não encontrado</h1><p class="muted">Verifique o slug informado.</p></section>';
        return;
      }

      applyPalette(broker.site.palette);
      renderBrokerPage(broker);
    });
  </script>
</body>

</html>
